<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Your Plan â€” CoreHabit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Handle Premium redirect -->
  <script>
    const params = new URLSearchParams(window.location.search);
    if (params.get("premium") === "success") {
      localStorage.setItem("corehabit_premium", "true");
    }
  </script>

  <link rel="stylesheet" href="./assets/styles.css">
  <link rel="stylesheet" href="./assets/premium.css">
</head>

<body style="
  min-height:100vh;
  background: radial-gradient(80% 80% at 20% 10%, #1a1f35 0%, #0b0f19 60%);
  color:#ffffff;
">

<div style="max-width:720px;margin:80px auto;padding:20px;font-family:system-ui;">

  <h1>Your Personalized Plan</h1>
  <p style="color:#9ca3af;">
    Based on your answers, hereâ€™s your CoreHabit plan.
  </p>

  <p id="status" style="margin-top:20px;font-weight:600;"></p>

  <div style="margin-top:20px;">
    <button id="generateBtn" onclick="generatePlan()" class="primary-btn">
      Generate My Plan
    </button>

    <button id="regenBtn" onclick="generatePlan()" class="secondary-btn" style="display:none;">
      Regenerate Plan
    </button>
  </div>

  <div id="result" style="
    margin-top:40px;
    padding:32px;
    background:#111827;
    color:#e5e7eb;
    border-radius:20px;
    box-shadow:0 20px 40px rgba(0,0,0,0.4);
    display:none;
  "></div>

  <!-- PREMIUM -->
  <div id="premium-root" style="margin-top:56px;">

    <h2 class="premium-title">
      CoreHabit Premium
      <span id="premium-badge" style="
        display:none;
        margin-left:12px;
        padding:6px 12px;
        border-radius:999px;
        font-size:11px;
        font-weight:900;
        background:linear-gradient(135deg,#d4af37,#f0d58c);
        color:#1a1a1a;
      ">PREMIUM</span>
    </h2>

    <p class="premium-subtitle">
      Everything you need to accelerate results â€” personalized and adaptive.
    </p>

    <div class="premium-lock-wrapper">

      <div class="premium-card"><h3>ğŸ›’ Grocery Lists</h3></div>
      <div class="premium-card"><h3>ğŸ½ï¸ 7-Day Meal Plans</h3></div>
      <div class="premium-card"><h3>ğŸ‹ï¸ Muscle Focus Workouts</h3></div>
      <div class="premium-card"><h3>ğŸ“Š Macro Targets</h3></div>
      <div class="premium-card"><h3>ğŸ” Weekly Updates</h3></div>

      <div id="premium-locked-overlay" class="premium-locked-overlay">
        <h3>Unlock CoreHabit Premium</h3>
        <p>Advanced plans, meals, groceries, and progress tracking.</p>
        <a href="/premium.html" class="premium-primary-btn">
          Upgrade to Premium
        </a>
      </div>

    </div>

  </div>

</div>

<div id="premium-toast" aria-live="polite">âœ¨ Premium Unlocked</div>

<!-- PREMIUM TOGGLE -->
<script>
  if (localStorage.getItem("corehabit_premium") === "true") {
    document.getElementById("premium-locked-overlay").style.display = "none";
    document.getElementById("premium-badge").style.display = "inline-block";

    const toast = document.getElementById("premium-toast");
    toast.style.opacity = "1";
    toast.style.transform = "translateY(0)";
    setTimeout(() => toast.style.opacity = "0", 4000);
  }
</script>

<!-- GENERATE PLAN -->
<script>
  async function generatePlan() {
    const statusEl = document.getElementById("status");
    const resultEl = document.getElementById("result");
    const regenBtn = document.getElementById("regenBtn");

    statusEl.textContent = "Creating your CoreHabit plan...";
    resultEl.style.display = "none";

    const onboardingRaw = localStorage.getItem("corehabit_onboarding");
    if (!onboardingRaw) {
      statusEl.textContent = "No onboarding data found.";
      return;
    }

    const response = await fetch("/.netlify/functions/generatePlan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        onboarding: JSON.parse(onboardingRaw),
        isPremium: localStorage.getItem("corehabit_premium") === "true"
      })
    });

    const responseData = await response.json();
    const data = responseData.plan;

    resultEl.style.display = "block";
    statusEl.textContent = "";

    resultEl.innerHTML = `
      <section><h2>Your CoreHabit Plan</h2><p>${data.overview}</p></section>
      <section><h3>Weekly Workout Split</h3><ul>${data.weekly_workout_split.map(d=>`<li>${d}</li>`).join("")}</ul></section>
      <section><h3>Sample Workout</h3><ul>${data.sample_workout.map(i=>`<li>${i}</li>`).join("")}</ul></section>
      <section><h3>Daily Nutrition Guidelines</h3><ul>${data.daily_nutrition_guidelines.map(i=>`<li>${i}</li>`).join("")}</ul></section>
      <section><h3>Sample Day of Eating</h3><ul>${data.sample_day_of_eating.map(i=>`<li>${i}</li>`).join("")}</ul></section>
      <section><h3>Weekly Focus Tip</h3><p>${data.weekly_focus_tip}</p></section>
    `;

    regenBtn.style.display = "inline-block";
  }
</script>

</body>
</html>
