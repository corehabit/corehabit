<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Your Plan ‚Äî CoreHabit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Premium feature flag -->
  <script>
    window.PREMIUM_ENABLED = true;
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="./assets/styles.css">
  <link rel="stylesheet" href="./assets/premium.css">
</head>

<body style="
  min-height:100vh;
  background: radial-gradient(
    80% 80% at 20% 10%,
    #1a1f35 0%,
    #0b0f19 60%
  );
  color:#ffffff;
">

  <!-- PAGE CONTAINER -->
  <div style="max-width:720px;margin:80px auto;padding:20px;font-family:system-ui;">

    <h1>Your Personalized Plan</h1>
    <p style="color:#9ca3af;">
      Based on your answers, here‚Äôs your CoreHabit plan.
    </p>

    <!-- STATUS -->
    <p id="status" style="margin-top:20px;font-weight:600;"></p>

    <!-- BUTTONS -->
    <div style="margin-top:20px;">
      <button id="generateBtn" onclick="generatePlan()" style="
        padding:14px 22px;
        border-radius:999px;
        border:none;
        background:#7c5cff;
        color:white;
        font-weight:700;
        font-size:16px;
        cursor:pointer;
      ">
        Generate My Plan
      </button>

      <button id="regenBtn" onclick="generatePlan()" style="
        margin-left:12px;
        padding:12px 20px;
        border-radius:999px;
        border:1px solid #7c5cff;
        background:transparent;
        color:#7c5cff;
        font-weight:600;
        font-size:14px;
        cursor:pointer;
        display:none;
      ">
        Regenerate Plan
      </button>
    </div>

    <!-- FREE PLAN -->
    <div id="result" style="
      margin-top:40px;
      padding:32px;
      background:#111827;
      color:#e5e7eb;
      border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,0.4);
      display:none;
    "></div>

    <!-- ======================
         PREMIUM SECTION
         ====================== -->
    <div id="premium-root" hidden style="margin-top:48px;">

      <h2 style="font-size:24px;margin-bottom:8px;">
        Upgrade to CoreHabit Premium
      </h2>

      <p style="color:#9ca3af;margin-bottom:32px;">
        Adaptive plans, real tracking, and weekly updates tailored to you.
      </p>

      <div class="premium-card">
        <h3>
          üõí Budget-Based Grocery List
          <span class="premium-pill">Premium</span>
        </h3>
        <p>
          Weekly groceries auto-generated to match your calories,
          macros, and budget level.
        </p>
      </div>

      <div class="premium-card">
        <h3>
          üçΩÔ∏è 7-Day Meal Plan
          <span class="premium-pill">Premium</span>
        </h3>
        <p>
          A full week of meals built from your targets and preferences,
          updated as your plan changes.
        </p>
      </div>

      <div class="premium-card">
        <h3>
          üèãÔ∏è Targeted Muscle Group Workouts
          <span class="premium-pill">Premium</span>
        </h3>
        <p>
          Optional muscle focus programming that adapts your training
          without sacrificing balance.
        </p>
      </div>

      <div class="premium-card">
        <h3>
          üìä Macro Targets & Progress Tracking
          <span class="premium-pill">Premium</span>
        </h3>
        <p>
          Exact calorie and macro targets with ongoing progress tracking.
        </p>
      </div>

      <div class="premium-card">
        <h3>
          üîÅ Weekly Check-Ins & Plan Updates
          <span class="premium-pill">Premium</span>
        </h3>
        <p>
          Weekly feedback and automatic plan adjustments based on results.
        </p>
      </div>

      <!-- ACCOUNT CTA -->
      <div class="premium-account-cta">

        <p class="premium-account-text">
          Premium requires an account so we can save your progress,
          update your plans, and personalize your experience over time.
        </p>

        <div class="premium-account-buttons">
          <button class="premium-primary-btn">
            Create Free Account
          </button>

          <button class="premium-secondary-btn">
            Log In
          </button>
        </div>

      </div>

    </div>

  </div>

  <!-- Premium toggle -->
  <script>
    if (window.PREMIUM_ENABLED) {
      document.getElementById("premium-root").hidden = false;
    }
  </script>

  <!-- Core logic -->
  <script>
    async function generatePlan() {
      const statusEl = document.getElementById("status");
      const resultEl = document.getElementById("result");
      const generateBtn = document.getElementById("generateBtn");
      const regenBtn = document.getElementById("regenBtn");

      generateBtn.disabled = true;
      generateBtn.textContent = "Generating...";
      statusEl.textContent = "Creating a fresh CoreHabit plan...";
      resultEl.style.display = "none";
      resultEl.innerHTML = "";

      const onboardingRaw = localStorage.getItem("corehabit_onboarding");

      if (!onboardingRaw) {
        statusEl.textContent = "No onboarding data found.";
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
        return;
      }

      const onboarding = JSON.parse(onboardingRaw);

      try {
        const response = await fetch("/.netlify/functions/generatePlan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ onboarding })
        });

        const data = await response.json();

        statusEl.textContent = "";
        resultEl.style.display = "block";

        resultEl.innerHTML = `
          <section style="margin-bottom:32px;">
            <h2>Overview</h2>
            <p>${data.overview}</p>
          </section>

          <section style="margin-bottom:32px;">
            <h2>Weekly Workout Split</h2>
            <ul>
              ${data.weekly_workout_split.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2>Sample Workout</h2>
            <ul>
              ${data.sample_workout.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2>Daily Nutrition Guidelines</h2>
            <ul>
              ${data.daily_nutrition_guidelines.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2>Sample Day of Eating</h2>
            <ul>
              ${data.sample_day_of_eating.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </section>

          <section>
            <h2>Weekly Focus</h2>
            <p>${data.weekly_focus_tip}</p>
          </section>
        `;

        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
        regenBtn.style.display = "inline-block";

      } catch (err) {
        statusEl.textContent = "Something went wrong.";
        resultEl.style.display = "block";
        resultEl.textContent = err.message;
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
      }
    }
  </script>

</body>
</html>
