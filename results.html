<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Your Plan â€” CoreHabit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script>
    window.PREMIUM_ENABLED = false;
  </script>

  <link rel="stylesheet" href="./assets/styles.css">
  <link rel="stylesheet" href="./assets/premium.css">
</head>

<body style="
  min-height:100vh;
  background: radial-gradient(
    80% 80% at 20% 10%,
    #1a1f35 0%,
    #0b0f19 60%
  ) !important;
  color:#ffffff;
">

  <!-- PAGE CONTAINER -->
  <div style="max-width:720px;margin:80px auto;padding:20px;font-family:system-ui;">

    <h1>Your Personalized Plan</h1>
    <p style="color:#9ca3af;">
      Based on your answers, hereâ€™s your CoreHabit plan.
    </p>

    <!-- STATUS -->
    <p id="status" style="margin-top:20px;font-weight:600;"></p>

    <!-- BUTTONS -->
    <div style="margin-top:20px;">
      <button id="generateBtn" onclick="generatePlan()" style="
        padding:14px 22px;
        border-radius:999px;
        border:none;
        background:#7c5cff;
        color:white;
        font-weight:700;
        font-size:16px;
        cursor:pointer;
      ">
        Generate My Plan
      </button>

      <button id="regenBtn" onclick="generatePlan()" style="
        margin-left:12px;
        padding:12px 20px;
        border-radius:999px;
        border:1px solid #7c5cff;
        background:transparent;
        color:#7c5cff;
        font-weight:600;
        font-size:14px;
        cursor:pointer;
        display:none;
      ">
        Regenerate Plan
      </button>
    </div>

    <!-- PLAN CARD -->
    <div id="result" style="
      margin-top:40px;
      padding:32px;
      background:#111827;
      color:#e5e7eb;
      border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,0.4);
      display:none;
    "></div>

    <!-- ðŸ”’ PREMIUM ROOT (ISOLATED & SAFE) -->
    <div id="premium-root" hidden>

      <div class="premium-card">
        <h3>ðŸ”’ Premium: Smart Grocery List</h3>
        <p>
          Automatically generated groceries based on your calories,
          protein goals, and weekly plan.
        </p>
        <button disabled>Upgrade to Unlock</button>
      </div>

    </div>

  </div>

  <!-- Premium visibility toggle -->
  <script>
    if (window.PREMIUM_ENABLED) {
      document.getElementById("premium-root").hidden = false;
    }
  </script>

  <!-- CoreHabit logic -->
  <script>
    async function generatePlan() {
      const statusEl = document.getElementById("status");
      const resultEl = document.getElementById("result");
      const generateBtn = document.getElementById("generateBtn");
      const regenBtn = document.getElementById("regenBtn");

      generateBtn.disabled = true;
      generateBtn.textContent = "Generating...";
      statusEl.textContent = "Creating a fresh CoreHabit plan...";
      resultEl.style.display = "none";
      resultEl.innerHTML = "";

      const onboardingRaw = localStorage.getItem("corehabit_onboarding");

      if (!onboardingRaw) {
        statusEl.textContent = "No onboarding data found.";
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
        return;
      }

      const onboarding = JSON.parse(onboardingRaw);

      try {
        const response = await fetch("/.netlify/functions/generatePlan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ onboarding })
        });

        const data = await response.json();

        statusEl.textContent = "";
        resultEl.style.display = "block";

        resultEl.innerHTML = `
          <section style="margin-bottom:32px;">
            <h2 style="font-size:22px;margin-bottom:10px;">Overview</h2>
            <p style="line-height:1.7;">${data.overview}</p>
          </section>

          <section style="margin-bottom:32px;">
            <h2 style="font-size:22px;margin-bottom:10px;">Weekly Workout Split</h2>
            <ul style="padding-left:20px;">
              ${data.weekly_workout_split.map(i => `<li style="margin-bottom:8px;">${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2 style="font-size:22px;margin-bottom:10px;">Sample Workout</h2>
            <ul style="padding-left:20px;">
              ${data.sample_workout.map(i => `<li style="margin-bottom:8px;">${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2 style="font-size:22px;margin-bottom:10px;">Daily Nutrition Guidelines</h2>
            <ul style="padding-left:20px;">
              ${data.daily_nutrition_guidelines.map(i => `<li style="margin-bottom:8px;">${i}</li>`).join("")}
            </ul>
          </section>

          <section style="margin-bottom:32px;">
            <h2 style="font-size:22px;margin-bottom:10px;">Sample Day of Eating</h2>
            <ul style="padding-left:20px;">
              ${data.sample_day_of_eating.map(i => `<li style="margin-bottom:8px;">${i}</li>`).join("")}
            </ul>
          </section>

          <section>
            <h2 style="font-size:22px;margin-bottom:10px;">Weekly Focus</h2>
            <p style="line-height:1.7;">${data.weekly_focus_tip}</p>
          </section>
        `;

        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
        regenBtn.style.display = "inline-block";

      } catch (err) {
        statusEl.textContent = "Something went wrong.";
        resultEl.style.display = "block";
        resultEl.textContent = err.message;
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate My Plan";
      }
    }
  </script>

</body>
</html>
