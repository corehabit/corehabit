<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Your Plan â€” CoreHabit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
<script>
  const PREMIUM_ENABLED = false; // flip to true when ready
</script>
  
  <!-- GLOBAL STYLES (ABSOLUTE PATH â€“ REQUIRED FOR NETLIFY) -->
  <link rel="stylesheet" href="./assets/styles.css">
</head>

<body>

  <div class="page-wrapper">

    <!-- HEADER -->
    <h1>Your Personalized Plan</h1>
    <p>
      Based on your answers, hereâ€™s your CoreHabit plan.
    </p>

    <!-- ACTION BUTTONS -->
    <div style="display:flex;gap:12px;margin:20px 0;">
      <button class="button-primary" id="generateBtn">
        Generate My Plan
      </button>

      <button class="button-secondary" id="regenBtn">
        Regenerate
      </button>
    </div>

    <!-- PREMIUM TABS -->
    <div style="margin-bottom:30px;">
      <strong>Plan</strong><br />
      Grocery List <span class="lock-pill">ðŸ”’ Premium</span><br />
      Budget <span class="lock-pill">ðŸ”’ Premium</span>
    </div>

    <!-- PLAN CONTENT -->
    <div class="card">

      <h2>Overview</h2>
      <p id="overviewText">Loading your planâ€¦</p>

      <h2>Weekly Workout Split</h2>
      <ul id="workoutSplit"></ul>

      <h2>Sample Workout</h2>
      <ul id="sampleWorkout"></ul>

      <h2>Daily Nutrition Guidelines</h2>
      <ul id="nutritionGuidelines"></ul>

      <h2>Sample Day of Eating</h2>
      <ul id="sampleEating"></ul>

      <p id="weeklyTip" style="margin-top:20px;font-style:italic;"></p>

    </div>

  </div>

  <!-- SCRIPT -->
  <script>
    const onboarding = JSON.parse(
      localStorage.getItem("corehabit_onboarding") || "{}"
    );

    const overviewText = document.getElementById("overviewText");
    const workoutSplit = document.getElementById("workoutSplit");
    const sampleWorkout = document.getElementById("sampleWorkout");
    const nutritionGuidelines = document.getElementById("nutritionGuidelines");
    const sampleEating = document.getElementById("sampleEating");
    const weeklyTip = document.getElementById("weeklyTip");

    async function generatePlan() {
      overviewText.textContent = "Generating your personalized planâ€¦";

      workoutSplit.innerHTML = "";
      sampleWorkout.innerHTML = "";
      nutritionGuidelines.innerHTML = "";
      sampleEating.innerHTML = "";
      weeklyTip.textContent = "";

      const res = await fetch("/.netlify/functions/generatePlan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ onboarding })
      });

      const plan = await res.json();

      overviewText.textContent = plan.overview;

      plan.weekly_workout_split.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        workoutSplit.appendChild(li);
      });

      plan.sample_workout.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        sampleWorkout.appendChild(li);
      });

      plan.daily_nutrition_guidelines.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        nutritionGuidelines.appendChild(li);
      });

      plan.sample_day_of_eating.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        sampleEating.appendChild(li);
      });

      weeklyTip.textContent = plan.weekly_focus_tip;
    }

    document.getElementById("generateBtn").onclick = generatePlan;
    document.getElementById("regenBtn").onclick = generatePlan;
  </script>

</body>
</html>
